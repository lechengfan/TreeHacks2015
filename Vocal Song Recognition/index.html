<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">

		<title>Shazam Part 2</title>

		<link href="stylesheets/index.css" rel="stylesheet" type="text/css">

		<script src="scripts/songSearch.js"></script>
		<script src="scripts/annyang.min.js"></script>
		<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>

	</head>

	<body>
		<h1>Song Search</h1>

		<p>Say something such as: "search spotify for gone by kanye west"</p>

		<div id="status_container">
		</div>

		<script>
		if (annyang) {
			console.log("annyang initialized");

			var statusContainer = document.getElementById("status_container");

			var commands = {
				'search spotify for *song (by *artist)': spotify,
				'search soundcloud for *song (by *artist)': soundcloud,
				'pause song': pauseSong,
				'resume song': resumeSong
			};

			var audio = document.createElement('audio');

			function spotify(song, artist) {
				var req = new XMLHttpRequest();
				if (!artist) {
					statusContainer.innerHTML = "<p id=\"status\">Searching for song " + song + "</p>";
					req.open('GET', 'https://api.spotify.com/v1/search?type=track&q=' + encodeURIComponent(song), true);
				} else {
					statusContainer.innerHTML = "<p id=\"status\">Searching for song " + song + " by " + artist + "</p>";
					req.open('GET', 'https://api.spotify.com/v1/search?type=track&q=' + encodeURIComponent(song + " " + artist), true);
				}
				req.onreadystatechange = function() {
					if (req.readyState == 4 && req.status == 200) {
						var data = JSON.parse(req.responseText);
						var firstResult = data.tracks.items[0];
						if (firstResult) {
							audio.setAttribute('src', firstResult.preview_url);
							statusContainer.innerHTML = "<p id=\"status\">Playing " + firstResult.name + " by " + firstResult.artists[0].name + "</p>";
							audio.play();
					  	} else {
					  		statusContainer.innerHTML = "<p> id=\"status\"Status: " + song + " not found</p>";
					  	}
				  	}
				};
				req.send(null);
			}

			function soundcloud(song, artist) {
				// var req = new XMLHttpRequest();
				// if (!artist) {
				// 	statusContainer.innerHTML = "<p id=\"status\">Searching for song " + song + "</p>";
				// 	req.open('GET', 'https://api.spotify.com/v1/search?type=track&q=' + encodeURIComponent(song), true);
				// } else {
				// 	statusContainer.innerHTML = "<p id=\"status\">Searching for song " + song + " by " + artist + "</p>";
				// 	req.open('GET', 'https://api.spotify.com/v1/search?type=track&q=' + encodeURIComponent(song + " " + artist), true);
				// }
				// req.onreadystatechange = function() {
				// 	if (req.readyState == 4 && req.status == 200) {
				// 		var data = JSON.parse(req.responseText);
				// 		var firstResult = data.tracks.items[0];
				// 		if (firstResult) {
				// 			audio.setAttribute('src', firstResult.preview_url);
				// 			statusContainer.innerHTML = "<p id=\"status\">Playing " + firstResult.name + " by " + firstResult.artists[0].name + "</p>";
				// 			audio.play();
				// 	  	} else {
				// 	  		statusContainer.innerHTML = "<p> id=\"status\"Status: " + song + " not found</p>";
				// 	  	}
				//   	}
				// };
				// req.send(null);
			}

			function pauseSong() {
				if (audio) {
					audio.pause();
					statusContainer.innerHTML = "<p id=\"status\">Paused song</p>";
				}
			}

			function resumeSong() {
				if (audio) {
					audio.play();
					statusContainer.innerHTML = "<p id=\"status\">Resumed song</p>";
				}
			}

			// Add our commands to annyang
			annyang.addCommands(commands);
			annyang.debug();

			// Start listening.
			annyang.start();
		}
		</script>
	</body>
</html>